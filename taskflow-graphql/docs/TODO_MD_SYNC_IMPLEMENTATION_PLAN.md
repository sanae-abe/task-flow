# TODO.md â†” TaskFlow App é€£æºå®Ÿè£…è¨ˆç”»

**ä½œæˆæ—¥**: 2025-11-09
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: 3è¦–ç‚¹åå¾©ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ä¿å®ˆæ€§ï¼‰

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ)
3. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶)
4. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶)
5. [å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ¯”è¼ƒ](#å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ¯”è¼ƒ)
6. [Phaseåˆ¥å®Ÿè£…è¨ˆç”»](#phaseåˆ¥å®Ÿè£…è¨ˆç”»)
7. [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…è©³ç´°](#ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…è©³ç´°)
8. [ãƒ†ã‚¹ãƒˆæˆ¦ç•¥](#ãƒ†ã‚¹ãƒˆæˆ¦ç•¥)
9. [ãƒªã‚¹ã‚¯ç®¡ç†](#ãƒªã‚¹ã‚¯ç®¡ç†)
10. [æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³](#æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³)

---

## æ¦‚è¦

### ç›®çš„

TaskFlow Appã®ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã®TODO.mdã‚’åŒæ–¹å‘åŒæœŸã•ã›ã€ä»¥ä¸‹ã‚’å®Ÿç¾ã™ã‚‹ï¼š

- âœ… Claude Code/Claude Desktopã§TODO.mdç·¨é›† â†’ TaskFlow Appã«è‡ªå‹•åæ˜ 
- âœ… TaskFlow Appã§ã‚¿ã‚¹ã‚¯æ“ä½œ â†’ TODO.mdã«è‡ªå‹•åæ˜ 
- âœ… Gitç®¡ç†å¯èƒ½ãªMarkdownå½¢å¼ã§ã®ã‚¿ã‚¹ã‚¯ç®¡ç†
- âœ… iTermåœæ­¢ãƒ»å†èµ·å‹•æ™‚ã®ã‚¿ã‚¹ã‚¯æ°¸ç¶šåŒ–

### èƒŒæ™¯

**èª²é¡Œ**:
- iTerm/ã‚¿ãƒ¼ãƒŸãƒŠãƒ«åœæ­¢æ™‚ã«Claude Codeã®TodoWriteãŒæ¶ˆå¤±
- ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã§ã®ã‚¿ã‚¹ã‚¯çŠ¶æ…‹å¼•ãç¶™ãä¸å¯

**è§£æ±ºç­–**:
- TODO.mdã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«é…ç½®ã—ã€Gitç®¡ç†
- TaskFlow Appã®IndexedDBã¨åŒæ–¹å‘åŒæœŸ
- MCPã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§Claude Code/Desktopã¨é€£æº

### ä¸»è¦æ©Ÿèƒ½

1. **File WatcheråŒæœŸ**: TODO.mdå¤‰æ›´ã‚’ç›£è¦–ã—ã¦è‡ªå‹•åæ˜ ï¼ˆæ¨å¥¨æ–¹å¼ï¼‰
2. **MCP ToolåŒæœŸ**: Claude Code/Desktopã‹ã‚‰æ˜ç¤ºçš„ã«åŒæœŸå®Ÿè¡Œ
3. **WebhookåŒæœŸ**: TaskFlow Appå†…ã®å¤‰æ›´ã‚’TODO.mdã¸è‡ªå‹•åæ˜ 
4. **3-way merge**: ç«¶åˆæ™‚ã®ãƒ‡ãƒ¼ã‚¿ãƒ­ã‚¹é˜²æ­¢

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ~/workspace/taskflow-app/                 â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   TODO.md    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚  File Watcher    â”‚              â”‚
â”‚  â”‚  (Markdown)  â”‚         â”‚  (chokidar)      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                          â”‚                         â”‚
â”‚         â”‚ parse                    â”‚ change event            â”‚
â”‚         â–¼                          â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚      TODO Sync Service                   â”‚               â”‚
â”‚  â”‚  â€¢ Markdown Parser (TODO.md â†’ Tasks)     â”‚               â”‚
â”‚  â”‚  â€¢ Markdown Generator (Tasks â†’ TODO.md)  â”‚               â”‚
â”‚  â”‚  â€¢ Conflict Resolver (3-way merge)       â”‚               â”‚
â”‚  â”‚  â€¢ Security Layer (Path validation)      â”‚               â”‚
â”‚  â”‚  â€¢ Performance Layer (Diff detection)    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                 â”‚                                            â”‚
â”‚                 â”‚ GraphQL Mutation                           â”‚
â”‚                 â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚      TaskFlow GraphQL Server             â”‚               â”‚
â”‚  â”‚  â€¢ MCP Server (26 tools + sync_todo_md)  â”‚               â”‚
â”‚  â”‚  â€¢ GraphQL API                           â”‚               â”‚
â”‚  â”‚  â€¢ IndexedDB Storage                     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                 â”‚                                            â”‚
â”‚                 â”‚ update                                     â”‚
â”‚                 â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚      React App (localhost:5173)          â”‚               â”‚
â”‚  â”‚  â€¢ Task List UI                          â”‚               â”‚
â”‚  â”‚  â€¢ Board View                            â”‚               â”‚
â”‚  â”‚  â€¢ IndexedDB (idb)                       â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Claude Code / Claude Desktop                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   MCP Client                             â”‚               â”‚
â”‚  â”‚   â€¢ create_task                          â”‚               â”‚
â”‚  â”‚   â€¢ sync_todo_md (New!)                  â”‚               â”‚
â”‚  â”‚   â€¢ export_board_markdown                â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

#### 1. TODO.md â†’ TaskFlow Appï¼ˆFile Watcheræ–¹å¼ï¼‰

```
TODO.mdç·¨é›†
  â†“
chokidar change event
  â†“
Debounce (500ms)
  â†“
Security validation (Path traversal check)
  â†“
Markdown Parser (å·®åˆ†ãƒ‘ãƒ¼ã‚¹)
  â†“
Sanitization (DOMPurify)
  â†“
3-way merge conflict detection
  â†“
IndexedDB batch write
  â†“
React Appè‡ªå‹•æ›´æ–°ï¼ˆSubscriptionçµŒç”±ï¼‰
```

#### 2. TaskFlow App â†’ TODO.mdï¼ˆWebhookæ–¹å¼ï¼‰

```
React Appã§Taskæ›´æ–°
  â†“
IndexedDB write
  â†“
GraphQL Subscription notification
  â†“
Webhook trigger (task.updated)
  â†“
Markdown Generator (å·®åˆ†ç”Ÿæˆ)
  â†“
TODO.md write (atomic operation)
  â†“
File Watcherä¸€æ™‚åœæ­¢ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰
```

#### 3. Claude Code/Desktop â†’ TODO.mdï¼ˆMCP Toolæ–¹å¼ï¼‰

```
Claude Code: "Sync TODO.md"
  â†“
MCP Tool: sync_todo_md
  â†“
Authentication check
  â†“
Directioné¸æŠ (import/export/bidirectional)
  â†“
Bidirectional Syncå®Ÿè¡Œ
  â†“
Success response
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

```
taskflow-graphql/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ sync/                          # æ–°è¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”‚   â”œâ”€â”€ todo-md-watcher.ts         # File Watcher
â”‚   â”‚   â”œâ”€â”€ markdown-parser.ts         # Markdown â†’ Taskå¤‰æ›
â”‚   â”‚   â”œâ”€â”€ markdown-generator.ts      # Task â†’ Markdownå¤‰æ›
â”‚   â”‚   â”œâ”€â”€ conflict-resolver.ts       # 3-way merge
â”‚   â”‚   â”œâ”€â”€ bidirectional-sync.ts      # åŒæ–¹å‘åŒæœŸãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ security/
â”‚   â”‚   â”‚   â”œâ”€â”€ path-validator.ts      # Path traversalå¯¾ç­–
â”‚   â”‚   â”‚   â”œâ”€â”€ sanitizer.ts           # Markdownã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”‚   â””â”€â”€ auth-validator.ts      # MCPèªè¨¼
â”‚   â”‚   â”œâ”€â”€ performance/
â”‚   â”‚   â”‚   â”œâ”€â”€ diff-detector.ts       # å·®åˆ†æ¤œå‡º
â”‚   â”‚   â”‚   â”œâ”€â”€ batch-writer.ts        # ãƒãƒƒãƒæ›¸ãè¾¼ã¿
â”‚   â”‚   â”‚   â””â”€â”€ cache-manager.ts       # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ interfaces/
â”‚   â”‚   â”‚   â”œâ”€â”€ file-system.interface.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ database.interface.ts
â”‚   â”‚   â”‚   â””â”€â”€ sync-service.interface.ts
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â”œâ”€â”€ markdown-parser.test.ts
â”‚   â”‚       â”œâ”€â”€ conflict-resolver.test.ts
â”‚   â”‚       â””â”€â”€ integration.test.ts
â”‚   â”œâ”€â”€ mcp/
â”‚   â”‚   â””â”€â”€ tools/
â”‚   â”‚       â””â”€â”€ todo-md-tools.ts       # æ–°è¦MCPãƒ„ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ task.ts                    # çµ±ä¸€å‹å®šç¾©ï¼ˆæ–°è¦ï¼‰
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ todo-sync.config.ts        # è¨­å®šå¤–éƒ¨åŒ–ï¼ˆæ–°è¦ï¼‰
â””â”€â”€ docs/
    â”œâ”€â”€ adr/                            # Architecture Decision Records
    â”‚   â”œâ”€â”€ 0001-file-watcher-approach.md
    â”‚   â”œâ”€â”€ 0002-3way-merge-strategy.md
    â”‚   â”œâ”€â”€ 0003-di-pattern-adoption.md
    â”‚   â”œâ”€â”€ 0004-security-requirements.md
    â”‚   â””â”€â”€ 0005-performance-optimization.md
    â””â”€â”€ TODO_MD_SYNC_IMPLEMENTATION_PLAN.md (ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«)
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

### ğŸ”´ Criticalï¼ˆå®Ÿè£…å¿…é ˆï¼‰

#### 1. ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«å¯¾ç­–

**è„…å¨**: ä»»æ„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®èª­ã¿æ›¸ãæ”»æ’ƒ

**å¯¾ç­–**:
```typescript
// src/sync/security/path-validator.ts
import path from 'path';

export class PathValidator {
  private allowedBasePath: string;

  constructor(basePath: string = process.cwd()) {
    this.allowedBasePath = path.resolve(basePath);
  }

  validate(filePath: string): string {
    const resolvedPath = path.resolve(this.allowedBasePath, filePath);

    if (!resolvedPath.startsWith(this.allowedBasePath)) {
      throw new Error('Path traversal detected');
    }

    return resolvedPath;
  }
}

// ä½¿ç”¨ä¾‹
const validator = new PathValidator();
const safePath = validator.validate(userInputPath); // throws if invalid
```

#### 2. MCP Toolèªè¨¼æ©Ÿæ§‹

**è„…å¨**: æ‚ªæ„ã‚ã‚‹MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿æ”¹ã–ã‚“

**å¯¾ç­–**:
```typescript
// src/sync/security/auth-validator.ts
import { z } from 'zod';

const MCP_AUTH_TOKEN_SCHEMA = z.string().min(32);

export class AuthValidator {
  validateMcpToken(token: string | undefined): boolean {
    if (!token) return false;

    try {
      MCP_AUTH_TOKEN_SCHEMA.parse(token);
      // ç’°å¢ƒå¤‰æ•°ã¨ç…§åˆ
      return token === process.env.MCP_AUTH_TOKEN;
    } catch {
      return false;
    }
  }
}

// src/mcp/tools/todo-md-tools.ts ã§ã®ä½¿ç”¨
export const syncTodoMdTool = {
  handler: async ({ todoPath, direction }, context) => {
    const authValidator = new AuthValidator();

    if (!authValidator.validateMcpToken(context.authToken)) {
      throw new Error('Unauthorized MCP access');
    }

    // åŒæœŸå‡¦ç†
  }
};
```

#### 3. Markdownã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

**è„…å¨**: XSSã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

**å¯¾ç­–**:
```typescript
// src/sync/security/sanitizer.ts
import DOMPurify from 'isomorphic-dompurify';

export class MarkdownSanitizer {
  sanitizeTitle(title: string): string {
    return DOMPurify.sanitize(title, {
      ALLOWED_TAGS: [],
      ALLOWED_ATTR: []
    });
  }

  sanitizeDescription(description: string): string {
    return DOMPurify.sanitize(description, {
      ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'code'],
      ALLOWED_ATTR: []
    });
  }
}

// markdown-parser.ts ã§ã®ä½¿ç”¨
const sanitizer = new MarkdownSanitizer();
const safeTitle = sanitizer.sanitizeTitle(rawTitle);
```

### ğŸŸ¡ Importantï¼ˆ1é€±é–“ä»¥å†…ï¼‰

#### 4. ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™

```typescript
// src/sync/security/path-validator.ts (æ‹¡å¼µ)
export class PathValidator {
  async validateFileSize(filePath: string, maxSizeMB: number = 5): Promise<void> {
    const stats = await fs.stat(filePath);
    const maxBytes = maxSizeMB * 1024 * 1024;

    if (stats.size > maxBytes) {
      throw new Error(`File size exceeds ${maxSizeMB}MB limit`);
    }
  }
}
```

#### 5. æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆæ©Ÿå¯†æƒ…å ±é™¤å¤–ï¼‰

```typescript
// src/utils/logger.ts (æ‹¡å¼µ)
import pino from 'pino';

const logger = pino({
  redact: {
    paths: ['*.password', '*.apiKey', '*.token', 'tasks.*.title'],
    remove: true
  }
});

// å®‰å…¨ãªãƒ­ã‚°
logger.info('TODO.md sync completed', {
  taskCount: tasks.length,
  syncDirection: direction
  // ã‚¿ã‚¹ã‚¯å†…å®¹ã¯å«ã‚ãªã„
});
```

#### 6. ç’°å¢ƒå¤‰æ•°ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
// src/config/todo-sync.config.ts
import { z } from 'zod';

const TODO_SYNC_CONFIG_SCHEMA = z.object({
  TODO_MD_PATH: z.string().default('./TODO.md'),
  TODO_DEBOUNCE_MS: z.number().min(100).max(5000).default(500),
  TODO_MAX_FILE_SIZE_MB: z.number().min(1).max(50).default(5),
  TODO_MAX_TASKS: z.number().min(100).max(100000).default(10000),
  TODO_WEBHOOKS_ENABLED: z.boolean().default(false),
  MCP_AUTH_TOKEN: z.string().min(32).optional(),
});

export const TODO_SYNC_CONFIG = TODO_SYNC_CONFIG_SCHEMA.parse({
  TODO_MD_PATH: process.env.TODO_MD_PATH,
  TODO_DEBOUNCE_MS: Number(process.env.TODO_DEBOUNCE_MS),
  TODO_MAX_FILE_SIZE_MB: Number(process.env.TODO_MAX_FILE_SIZE_MB),
  TODO_MAX_TASKS: Number(process.env.TODO_MAX_TASKS),
  TODO_WEBHOOKS_ENABLED: process.env.TODO_WEBHOOKS_ENABLED === 'true',
  MCP_AUTH_TOKEN: process.env.MCP_AUTH_TOKEN,
});
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶

### ç›®æ¨™æ€§èƒ½

| æ“ä½œ | ç›®æ¨™æ™‚é–“ | æœ€å¤§è¨±å®¹æ™‚é–“ |
|------|---------|------------|
| TODO.mdå¤‰æ›´æ¤œå‡º | <100ms | 500ms |
| Markdownè§£æï¼ˆ100ã‚¿ã‚¹ã‚¯ï¼‰ | <200ms | 1s |
| IndexedDBåŒæœŸï¼ˆ100ã‚¿ã‚¹ã‚¯ï¼‰ | <300ms | 1s |
| TODO.mdç”Ÿæˆï¼ˆ1000ã‚¿ã‚¹ã‚¯ï¼‰ | <500ms | 2s |
| ç«¶åˆè§£æ±ºï¼ˆ100ã‚¿ã‚¹ã‚¯ï¼‰ | <400ms | 1.5s |

### ğŸ”´ Criticalï¼ˆå®Ÿè£…å¿…é ˆï¼‰

#### 1. IndexedDBãƒãƒƒãƒæ›¸ãè¾¼ã¿

**å•é¡Œ**: N+1å•é¡Œã§100ã‚¿ã‚¹ã‚¯ã«100å›æ›¸ãè¾¼ã¿

**å¯¾ç­–**:
```typescript
// src/sync/performance/batch-writer.ts
import { openDB } from 'idb';

export class BatchWriter {
  async bulkUpsertTasks(tasks: Task[]): Promise<void> {
    const db = await openDB('taskflow', 1);

    await db.transaction('rw', db.tasks, async () => {
      // 1ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§å…¨ã‚¿ã‚¹ã‚¯æ›¸ãè¾¼ã¿
      await db.tasks.bulkPut(tasks);
    });
  }
}

// ä½¿ç”¨ä¾‹ï¼ˆä¿®æ­£å‰ï¼‰
// âŒ N+1å•é¡Œ
for (const task of tasks) {
  await db.tasks.put(task); // 100ã‚¿ã‚¹ã‚¯ = 100ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³
}

// ä½¿ç”¨ä¾‹ï¼ˆä¿®æ­£å¾Œï¼‰
// âœ… ãƒãƒƒãƒæ›¸ãè¾¼ã¿
const batchWriter = new BatchWriter();
await batchWriter.bulkUpsertTasks(tasks); // 1ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³
```

#### 2. å·®åˆ†æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯

**å•é¡Œ**: TODO.mdå…¨ä½“ã‚’æ¯å›ãƒ‘ãƒ¼ã‚¹

**å¯¾ç­–**:
```typescript
// src/sync/performance/diff-detector.ts
import { diff, DIFF_INSERT, DIFF_DELETE, DIFF_EQUAL } from 'fast-diff';

export class DiffDetector {
  detectChanges(oldContent: string, newContent: string): ChangedLines {
    const changes = diff(oldContent, newContent);
    const changedLines: number[] = [];

    let lineNumber = 0;
    for (const [operation, text] of changes) {
      const lineCount = text.split('\n').length - 1;

      if (operation === DIFF_INSERT || operation === DIFF_DELETE) {
        for (let i = 0; i < lineCount; i++) {
          changedLines.push(lineNumber + i);
        }
      }

      lineNumber += lineCount;
    }

    return { changedLines, totalLines: lineNumber };
  }
}

// markdown-parser.ts ã§ã®ä½¿ç”¨
export class MarkdownParser {
  private lastContent: string = '';
  private diffDetector = new DiffDetector();

  async parseIncremental(filePath: string): Promise<ParsedTask[]> {
    const newContent = await fs.readFile(filePath, 'utf-8');
    const { changedLines } = this.diffDetector.detectChanges(
      this.lastContent,
      newContent
    );

    // å¤‰æ›´è¡Œã®ã¿ãƒ‘ãƒ¼ã‚¹
    const lines = newContent.split('\n');
    const changedTasks = this.parseLines(
      changedLines.map(i => lines[i])
    );

    this.lastContent = newContent;
    return changedTasks;
  }
}
```

#### 3. Throttle + Debounceçµ„ã¿åˆã‚ã›

**å•é¡Œ**: é€£ç¶šç·¨é›†æ™‚ã«éå‰°ãªåŒæœŸå‡¦ç†

**å¯¾ç­–**:
```typescript
// src/sync/todo-md-watcher.ts
import { throttle } from 'lodash-es';

export class TodoMdWatcher {
  private syncThrottled = throttle(
    async (tasks: ParsedTask[]) => {
      // å·®åˆ†ã®ã¿åŒæœŸ
      const diff = await this.diffDetector.computeDiff(
        this.lastSyncedTasks,
        tasks
      );
      await this.batchWriter.bulkUpsertTasks(diff.added.concat(diff.updated));
      this.lastSyncedTasks = tasks;
    },
    2000, // 2ç§’é–“ã«æœ€å¤§1å›
    { leading: false, trailing: true }
  );

  start() {
    this.watcher.on('change', async (path) => {
      // Debounce: 500ms
      clearTimeout(this.debounceTimeout);
      this.debounceTimeout = setTimeout(async () => {
        const tasks = await this.parser.parseIncremental(path);
        await this.syncThrottled(tasks);
      }, 500);
    });
  }
}
```

### ğŸŸ¡ Importantï¼ˆ1é€±é–“ä»¥å†…ï¼‰

#### 4. DataLoaderæ´»ç”¨

```typescript
// src/utils/dataloader.ts (æ‹¡å¼µ)
import DataLoader from 'dataloader';

export const createTaskLoader = () => {
  return new DataLoader<string, Task>(async (ids) => {
    const db = await openDB('taskflow', 1);
    const tasks = await db.tasks.bulkGet(ids);
    return tasks;
  }, {
    cache: true,
    maxBatchSize: 100
  });
};

// Resolver ã§ã®ä½¿ç”¨
export const taskResolvers = {
  Query: {
    tasks: async (_, __, context) => {
      const taskIds = await getAllTaskIds();
      return context.taskLoader.loadMany(taskIds);
    }
  }
};
```

#### 5. chokidaræœ€é©åŒ–

```typescript
// src/sync/todo-md-watcher.ts
import { watch } from 'chokidar';

export class TodoMdWatcher {
  constructor(private todoPath: string) {
    this.watcher = watch(todoPath, {
      persistent: true,
      ignoreInitial: false,
      ignored: /(^|[\/\\])\.(git|node_modules)/, // é™¤å¤–
      awaitWriteFinish: {
        stabilityThreshold: 1000, // 1ç§’é–“å¤‰æ›´ãªã—ã§ç¢ºå®š
        pollInterval: 100
      }
    });
  }
}
```

#### 6. ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–

```typescript
// src/sync/performance/cache-manager.ts
export class CacheManager {
  private cache: Map<string, ParsedTask[]> = new Map();
  private maxCacheSize = 10000;

  set(key: string, tasks: ParsedTask[]): void {
    if (this.cache.size >= this.maxCacheSize) {
      // æœ€å¤ã®ã‚¨ãƒ³ãƒˆãƒªã‚’å‰Šé™¤ï¼ˆLRUï¼‰
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, tasks);
  }

  get(key: string): ParsedTask[] | undefined {
    return this.cache.get(key);
  }

  clear(): void {
    this.cache.clear();
  }
}
```

---

## å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ¯”è¼ƒ

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1: File Watcheræ–¹å¼ï¼ˆæ¨å¥¨ï¼‰

**ç‰¹å¾´**: TODO.mdã®å¤‰æ›´ã‚’ç›£è¦–ã—ã¦è‡ªå‹•åæ˜ 

**åˆ©ç‚¹**:
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸï¼ˆ<1ç§’ï¼‰
- âœ… Claude Codeç·¨é›†ã¨ã®è¦ªå’Œæ€§é«˜
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œä¸è¦
- âœ… Gitç®¡ç†ã¨ã®ç›¸æ€§è‰¯å¥½

**æ¬ ç‚¹**:
- âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ™ãƒ³ãƒˆä¾å­˜
- âš ï¸ ç„¡é™ãƒ«ãƒ¼ãƒ—ãƒªã‚¹ã‚¯ï¼ˆåŒæ–¹å‘åŒæœŸæ™‚ï¼‰

**å®Ÿè£…é›£æ˜“åº¦**: ä¸­

**æ¨å¥¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**: ãƒ¡ã‚¤ãƒ³åŒæœŸæ–¹å¼ã¨ã—ã¦æ¡ç”¨

---

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2: MCP Toolæ–¹å¼

**ç‰¹å¾´**: Claude Code/Desktopã‹ã‚‰æ˜ç¤ºçš„ã«åŒæœŸ

**åˆ©ç‚¹**:
- âœ… åˆ¶å¾¡ã—ã‚„ã™ã„
- âœ… æ„å›³çš„ãªåŒæœŸã®ã¿å®Ÿè¡Œ
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®¹æ˜“
- âœ… æ—¢å­˜MCPã‚¤ãƒ³ãƒ•ãƒ©æ´»ç”¨

**æ¬ ç‚¹**:
- âš ï¸ æ‰‹å‹•å®Ÿè¡ŒãŒå¿…è¦
- âš ï¸ åŒæœŸå¿˜ã‚Œãƒªã‚¹ã‚¯

**å®Ÿè£…é›£æ˜“åº¦**: ä½

**æ¨å¥¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**: File Watcherã®è£œåŠ©ã€æ‰‹å‹•åŒæœŸ

---

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ3: Webhookæ–¹å¼

**ç‰¹å¾´**: TaskFlow Appå†…ã®å¤‰æ›´ã‚’TODO.mdã¸è‡ªå‹•åæ˜ 

**åˆ©ç‚¹**:
- âœ… æ—¢å­˜Webhookæ©Ÿèƒ½æ´»ç”¨
- âœ… ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- âœ… æ‹¡å¼µæ€§é«˜ã„

**æ¬ ç‚¹**:
- âš ï¸ Webhookè¨­å®šãŒå¿…è¦
- âš ï¸ ç‰‡æ–¹å‘åŒæœŸã®ã¿

**å®Ÿè£…é›£æ˜“åº¦**: ä½

**æ¨å¥¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**: TaskFlow App â†’ TODO.mdåŒæœŸ

---

### æ¨å¥¨æ§‹æˆ

**ãƒ¡ã‚¤ãƒ³**: File Watcherï¼ˆTODO.md â†’ TaskFlow Appï¼‰
**ã‚µãƒ–1**: Webhookï¼ˆTaskFlow App â†’ TODO.mdï¼‰
**ã‚µãƒ–2**: MCP Toolï¼ˆæ‰‹å‹•åŒæœŸãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰

---

## Phaseåˆ¥å®Ÿè£…è¨ˆç”»

### Phase 0: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ”¹å–„ï¼ˆWeek 1ï¼‰

**ç›®çš„**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»å‹å®šç¾©ã®åŸºç›¤æ•´å‚™

#### Day 1-2: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

- [ ] **Path Validatorå®Ÿè£…**
  - `src/sync/security/path-validator.ts` ä½œæˆ
  - ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«å¯¾ç­–
  - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™
  - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ10ã‚±ãƒ¼ã‚¹ï¼‰

- [ ] **Auth Validatorå®Ÿè£…**
  - `src/sync/security/auth-validator.ts` ä½œæˆ
  - MCPèªè¨¼æ©Ÿæ§‹
  - ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
  - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ8ã‚±ãƒ¼ã‚¹ï¼‰

- [ ] **Markdown Sanitizerå®Ÿè£…**
  - `src/sync/security/sanitizer.ts` ä½œæˆ
  - `isomorphic-dompurify` å°å…¥
  - XSSå¯¾ç­–
  - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ15ã‚±ãƒ¼ã‚¹ï¼‰

#### Day 3-4: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºç›¤

- [ ] **Batch Writerå®Ÿè£…**
  - `src/sync/performance/batch-writer.ts` ä½œæˆ
  - IndexedDB bulkPutå®Ÿè£…
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æœ€é©åŒ–
  - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ12ã‚±ãƒ¼ã‚¹ï¼‰

- [ ] **Diff Detectorå®Ÿè£…**
  - `src/sync/performance/diff-detector.ts` ä½œæˆ
  - `fast-diff` å°å…¥
  - å·®åˆ†æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
  - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ20ã‚±ãƒ¼ã‚¹ï¼‰

- [ ] **Throttle + Debounceå®Ÿè£…**
  - `lodash-es` å°å…¥
  - `todo-md-watcher.ts` ã«throttleçµ±åˆ
  - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ8ã‚±ãƒ¼ã‚¹ï¼‰

#### Day 5: å‹å®šç¾©çµ±ä¸€

- [ ] **Single Source of Truthå®Ÿè£…**
  - `src/types/task.ts` ä½œæˆ
  - `BaseTask`, `ParsedTask`, `DbTask`, `GqlTask` å®šç¾©
  - æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®å‹ç½®ãæ›ãˆ
  - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ5ã‚±ãƒ¼ã‚¹ï¼‰

```typescript
// src/types/task.ts
export interface BaseTask {
  id: string;
  title: string;
  status: 'pending' | 'in_progress' | 'completed';
  priority: 'low' | 'medium' | 'high';
  dueDate?: string;
  createdAt: Date;
  updatedAt: Date;
}

export interface ParsedTask extends Omit<BaseTask, 'id' | 'createdAt' | 'updatedAt'> {
  section: string; // Markdownå›ºæœ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
}

export type DbTask = BaseTask; // IndexedDBç”¨
export type GqlTask = BaseTask; // GraphQLç”¨
```

#### Day 6-7: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒ­ã‚°

- [ ] **Retry + Circuit Breakerå®Ÿè£…**
  - `@lifeomic/attempt` å°å…¥
  - `opossum` å°å…¥
  - `src/sync/resilience/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
  - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ15ã‚±ãƒ¼ã‚¹ï¼‰

```typescript
// src/sync/resilience/retry-handler.ts
import { retry } from '@lifeomic/attempt';
import CircuitBreaker from 'opossum';

export const createSyncCircuitBreaker = (syncFn: Function) => {
  return new CircuitBreaker(syncFn, {
    timeout: 5000,
    errorThresholdPercentage: 50,
    resetTimeout: 30000
  });
};

export const retryWithCircuitBreaker = async (fn: Function) => {
  return retry(async () => {
    return await fn();
  }, {
    maxAttempts: 3,
    delay: 1000,
    factor: 2 // exponential backoff
  });
};
```

- [ ] **æ§‹é€ åŒ–ãƒ­ã‚°å®Ÿè£…**
  - `pino` æ—¢å­˜è¨­å®šæ‹¡å¼µ
  - æ©Ÿå¯†æƒ…å ±redactè¨­å®š
  - ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ5ã‚±ãƒ¼ã‚¹ï¼‰

**æˆæœç‰©**:
- `src/sync/security/` (3ãƒ•ã‚¡ã‚¤ãƒ«)
- `src/sync/performance/` (3ãƒ•ã‚¡ã‚¤ãƒ«)
- `src/sync/resilience/` (2ãƒ•ã‚¡ã‚¤ãƒ«)
- `src/types/task.ts`
- `src/config/todo-sync.config.ts`
- ãƒ†ã‚¹ãƒˆ: 98ã‚±ãƒ¼ã‚¹

**æ‰€è¦æ™‚é–“**: 7æ—¥é–“ï¼ˆ56æ™‚é–“ï¼‰

---

### Phase 1: Markdown Parserå®Ÿè£…ï¼ˆWeek 2: Day 8-10ï¼‰

**å‰æ**: Phase 0å®Œäº†

#### Day 8-9: Parseræœ¬ä½“å®Ÿè£…

- [ ] **Markdown Parserå®Ÿè£…**
  - `src/sync/markdown-parser.ts` ä½œæˆ
  - å·®åˆ†ãƒ‘ãƒ¼ã‚¹å¯¾å¿œï¼ˆDiff Detectorçµ±åˆï¼‰
  - ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆ
  - ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºï¼ˆğŸ”´æœ€å„ªå…ˆã€ğŸŸ é«˜å„ªå…ˆåº¦ç­‰ï¼‰
  - ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ¤œå‡ºï¼ˆ`[ ]`, `[x]`ï¼‰
  - å„ªå…ˆåº¦æ¨æ¸¬ãƒ­ã‚¸ãƒƒã‚¯

```typescript
// src/sync/markdown-parser.ts
import { PathValidator } from './security/path-validator';
import { MarkdownSanitizer } from './security/sanitizer';
import { DiffDetector } from './performance/diff-detector';
import type { ParsedTask } from '../types/task';

export class MarkdownParser {
  private lastContent: string = '';
  private pathValidator: PathValidator;
  private sanitizer: MarkdownSanitizer;
  private diffDetector: DiffDetector;

  constructor() {
    this.pathValidator = new PathValidator();
    this.sanitizer = new MarkdownSanitizer();
    this.diffDetector = new DiffDetector();
  }

  async parse(filePath: string): Promise<ParsedTask[]> {
    const safePath = this.pathValidator.validate(filePath);
    await this.pathValidator.validateFileSize(safePath);

    const content = await fs.readFile(safePath, 'utf-8');
    return this.parseContent(content);
  }

  async parseIncremental(filePath: string): Promise<ParsedTask[]> {
    const safePath = this.pathValidator.validate(filePath);
    const newContent = await fs.readFile(safePath, 'utf-8');

    const { changedLines } = this.diffDetector.detectChanges(
      this.lastContent,
      newContent
    );

    const lines = newContent.split('\n');
    const tasks = this.parseLines(
      changedLines.map(i => lines[i])
    );

    this.lastContent = newContent;
    return tasks;
  }

  private parseContent(content: string): ParsedTask[] {
    const tasks: ParsedTask[] = [];
    let currentSection = '';

    const lines = content.split('\n');

    for (const line of lines) {
      // ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡º
      if (line.startsWith('## ')) {
        currentSection = line.replace('## ', '').trim();
        continue;
      }

      // ã‚¿ã‚¹ã‚¯æ¤œå‡º
      const taskMatch = line.match(/^- \[([ xX])\] (.+)/);
      if (taskMatch) {
        const [_, status, rawTitle] = taskMatch;
        const title = this.sanitizer.sanitizeTitle(rawTitle.trim());

        // å„ªå…ˆåº¦åˆ¤å®š
        let priority: 'low' | 'medium' | 'high' = 'medium';
        if (currentSection.includes('ğŸ”´') || currentSection.includes('æœ€å„ªå…ˆ')) {
          priority = 'high';
        } else if (currentSection.includes('ğŸŸ¢') || currentSection.includes('é•·æœŸ')) {
          priority = 'low';
        }

        tasks.push({
          title,
          status: status.toLowerCase() === 'x' ? 'completed' : 'pending',
          priority,
          section: currentSection,
        });
      }
    }

    return tasks;
  }

  private parseLines(lines: string[]): ParsedTask[] {
    // å¤‰æ›´è¡Œã®ã¿ãƒ‘ãƒ¼ã‚¹ï¼ˆå®Ÿè£…çœç•¥ï¼‰
    return [];
  }
}
```

#### Day 10: ãƒ†ã‚¹ãƒˆå®Ÿè£…

- [ ] **å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè£…**
  - `src/sync/__tests__/markdown-parser.test.ts` ä½œæˆ
  - æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆï¼ˆ15ã‚±ãƒ¼ã‚¹ï¼‰
  - ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆï¼ˆ10ã‚±ãƒ¼ã‚¹ï¼‰
  - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆ5ã‚±ãƒ¼ã‚¹ï¼‰
  - ã‚«ãƒãƒ¬ãƒƒã‚¸90%+é”æˆ

```typescript
// src/sync/__tests__/markdown-parser.test.ts
import { describe, it, expect } from 'vitest';
import { MarkdownParser } from '../markdown-parser';

describe('MarkdownParser', () => {
  describe('parse', () => {
    it('should parse simple tasks', async () => {
      const parser = new MarkdownParser();
      const tasks = await parser.parse('./fixtures/simple.md');

      expect(tasks).toHaveLength(3);
      expect(tasks[0].title).toBe('Task 1');
      expect(tasks[0].status).toBe('pending');
    });

    it('should detect completed tasks', async () => {
      const parser = new MarkdownParser();
      const tasks = await parser.parse('./fixtures/completed.md');

      expect(tasks[0].status).toBe('completed');
    });

    it('should sanitize XSS in titles', async () => {
      const parser = new MarkdownParser();
      const tasks = await parser.parse('./fixtures/xss.md');

      expect(tasks[0].title).not.toContain('<script>');
    });

    it('should throw on path traversal', async () => {
      const parser = new MarkdownParser();

      await expect(parser.parse('../../../etc/passwd')).rejects.toThrow(
        'Path traversal detected'
      );
    });

    // ... æ®‹ã‚Š26ã‚±ãƒ¼ã‚¹
  });
});
```

**æˆæœç‰©**:
- `src/sync/markdown-parser.ts` (200è¡Œ)
- `src/sync/__tests__/markdown-parser.test.ts` (400è¡Œ)
- ãƒ†ã‚¹ãƒˆ: 30ã‚±ãƒ¼ã‚¹ã€ã‚«ãƒãƒ¬ãƒƒã‚¸90%+

**æ‰€è¦æ™‚é–“**: 3æ—¥é–“ï¼ˆ24æ™‚é–“ï¼‰

---

### Phase 2: File Watcher + DIå®Ÿè£…ï¼ˆWeek 2-3: Day 11-17ï¼‰

**å‰æ**: Phase 1å®Œäº†

#### Day 11-12: DIåŸºç›¤æ§‹ç¯‰

- [ ] **FileSystemæŠ½è±¡åŒ–**
  - `src/sync/interfaces/file-system.interface.ts` ä½œæˆ
  - å®Ÿè£…: `RealFileSystem`, `MockFileSystem`

```typescript
// src/sync/interfaces/file-system.interface.ts
export interface FileSystem {
  readFile(path: string): Promise<string>;
  writeFile(path: string, content: string): Promise<void>;
  stat(path: string): Promise<{ size: number; mtime: Date }>;
}

// src/sync/file-system/real-file-system.ts
export class RealFileSystem implements FileSystem {
  async readFile(path: string): Promise<string> {
    return await fs.readFile(path, 'utf-8');
  }

  async writeFile(path: string, content: string): Promise<void> {
    await fs.writeFile(path, content, 'utf-8');
  }

  async stat(path: string): Promise<{ size: number; mtime: Date }> {
    const stats = await fs.stat(path);
    return { size: stats.size, mtime: stats.mtime };
  }
}

// src/sync/file-system/mock-file-system.ts (ãƒ†ã‚¹ãƒˆç”¨)
export class MockFileSystem implements FileSystem {
  private files: Map<string, string> = new Map();

  async readFile(path: string): Promise<string> {
    return this.files.get(path) || '';
  }

  async writeFile(path: string, content: string): Promise<void> {
    this.files.set(path, content);
  }

  async stat(path: string): Promise<{ size: number; mtime: Date }> {
    const content = this.files.get(path) || '';
    return { size: content.length, mtime: new Date() };
  }
}
```

- [ ] **DatabaseæŠ½è±¡åŒ–**
  - `src/sync/interfaces/database.interface.ts` ä½œæˆ
  - å®Ÿè£…: `IndexedDbAdapter`, `MockDatabase`

- [ ] **è²¬å‹™åˆ†é›¢**
  - `Parser`, `Syncer`, `Notifier` ã®åˆ†é›¢
  - `SyncService` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©

#### Day 13-14: Watcherå®Ÿè£…

- [ ] **TodoMdWatcherå®Ÿè£…**
  - `src/sync/todo-md-watcher.ts` ä½œæˆ
  - chokidaræœ€é©åŒ–è¨­å®š
  - Throttle + Debounceçµ±åˆ
  - ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–ï¼ˆCacheManagerä½¿ç”¨ï¼‰
  - ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼ˆä¸€æ™‚åœæ­¢æ©Ÿæ§‹ï¼‰

```typescript
// src/sync/todo-md-watcher.ts
import { watch, FSWatcher } from 'chokidar';
import { throttle } from 'lodash-es';
import type { FileSystem } from './interfaces/file-system.interface';
import type { Database } from './interfaces/database.interface';
import { MarkdownParser } from './markdown-parser';
import { BatchWriter } from './performance/batch-writer';
import { DiffDetector } from './performance/diff-detector';
import { TODO_SYNC_CONFIG } from '../config/todo-sync.config';

export class TodoMdWatcher {
  private watcher: FSWatcher;
  private debounceTimeout: NodeJS.Timeout | null = null;
  private lastSyncedTasks: ParsedTask[] = [];
  private isPaused = false;

  private syncThrottled = throttle(
    async (tasks: ParsedTask[]) => {
      const diff = await this.diffDetector.computeDiff(
        this.lastSyncedTasks,
        tasks
      );

      await this.batchWriter.bulkUpsertTasks(
        diff.added.concat(diff.updated)
      );

      this.lastSyncedTasks = tasks;
    },
    TODO_SYNC_CONFIG.TODO_DEBOUNCE_MS * 4,
    { leading: false, trailing: true }
  );

  constructor(
    private todoPath: string,
    private fs: FileSystem,
    private db: Database,
    private parser: MarkdownParser,
    private batchWriter: BatchWriter,
    private diffDetector: DiffDetector
  ) {
    this.watcher = watch(todoPath, {
      persistent: true,
      ignoreInitial: false,
      ignored: /(^|[\/\\])\.(git|node_modules)/,
      awaitWriteFinish: {
        stabilityThreshold: 1000,
        pollInterval: 100
      }
    });
  }

  start(): void {
    this.watcher.on('change', async (path) => {
      if (this.isPaused) {
        console.log('Watcher paused, skipping...');
        return;
      }

      clearTimeout(this.debounceTimeout);
      this.debounceTimeout = setTimeout(async () => {
        try {
          const tasks = await this.parser.parseIncremental(path);
          await this.syncThrottled(tasks);
        } catch (error) {
          console.error('Sync error:', error);
          // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ç¶™ç¶šå‹•ä½œ
        }
      }, TODO_SYNC_CONFIG.TODO_DEBOUNCE_MS);
    });
  }

  pause(): void {
    this.isPaused = true;
  }

  resume(): void {
    this.isPaused = false;
  }

  async stop(): Promise<void> {
    await this.watcher.close();
    clearTimeout(this.debounceTimeout);
  }
}
```

#### Day 15-17: 3-way mergeå®Ÿè£…

- [ ] **Conflict Resolverå®Ÿè£…**
  - `src/sync/conflict-resolver.ts` ä½œæˆ
  - ç«¶åˆæ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
  - åŸºæœ¬çš„ãªè‡ªå‹•è§£æ±ºï¼ˆLast-Write-Winsï¼‰
  - æ‰‹å‹•è§£æ±ºæº–å‚™ï¼ˆUIæœªå®Ÿè£…ï¼‰

```typescript
// src/sync/conflict-resolver.ts
import type { Task, ParsedTask } from '../types/task';

export interface ConflictResolution {
  strategy: 'last-write-wins' | 'manual' | '3-way-merge';
  conflicts: TaskConflict[];
  resolvedTasks: Task[];
}

export interface TaskConflict {
  taskId: string;
  base: Task;
  local: Task; // IndexedDB
  remote: ParsedTask; // TODO.md
  conflictType: 'both-modified' | 'local-deleted' | 'remote-deleted';
}

export class ConflictResolver {
  async resolve(
    baseTasks: Task[],
    localTasks: Task[],
    remoteTasks: ParsedTask[]
  ): Promise<ConflictResolution> {
    const conflicts = this.detectConflicts(baseTasks, localTasks, remoteTasks);

    if (conflicts.length === 0) {
      // ç«¶åˆãªã—: 3-way merge
      return {
        strategy: '3-way-merge',
        conflicts: [],
        resolvedTasks: this.merge3Way(baseTasks, localTasks, remoteTasks)
      };
    }

    // ç«¶åˆã‚ã‚Š: Last-Write-Winsï¼ˆæ‰‹å‹•è§£æ±ºã¯å°†æ¥å®Ÿè£…ï¼‰
    return {
      strategy: 'last-write-wins',
      conflicts,
      resolvedTasks: this.resolveByLastWrite(localTasks, remoteTasks)
    };
  }

  private detectConflicts(
    baseTasks: Task[],
    localTasks: Task[],
    remoteTasks: ParsedTask[]
  ): TaskConflict[] {
    const conflicts: TaskConflict[] = [];
    const baseMap = new Map(baseTasks.map(t => [t.id, t]));
    const localMap = new Map(localTasks.map(t => [t.id, t]));
    const remoteMap = new Map(remoteTasks.map(t => [t.title, t])); // titleãƒ™ãƒ¼ã‚¹

    for (const [id, localTask] of localMap) {
      const baseTask = baseMap.get(id);
      const remoteTask = remoteMap.get(localTask.title);

      if (!baseTask) continue; // æ–°è¦ã‚¿ã‚¹ã‚¯
      if (!remoteTask) {
        // ãƒªãƒ¢ãƒ¼ãƒˆã§å‰Šé™¤
        conflicts.push({
          taskId: id,
          base: baseTask,
          local: localTask,
          remote: null,
          conflictType: 'remote-deleted'
        });
        continue;
      }

      // ä¸¡æ–¹ã§å¤‰æ›´
      if (
        localTask.status !== baseTask.status &&
        remoteTask.status !== baseTask.status
      ) {
        conflicts.push({
          taskId: id,
          base: baseTask,
          local: localTask,
          remote: remoteTask,
          conflictType: 'both-modified'
        });
      }
    }

    return conflicts;
  }

  private merge3Way(
    baseTasks: Task[],
    localTasks: Task[],
    remoteTasks: ParsedTask[]
  ): Task[] {
    // 3-way mergeãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç«¶åˆãªã—å‰æï¼‰
    const merged: Task[] = [];

    // ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ›´ã‚’å„ªå…ˆ
    for (const localTask of localTasks) {
      merged.push(localTask);
    }

    // ãƒªãƒ¢ãƒ¼ãƒˆæ–°è¦è¿½åŠ 
    for (const remoteTask of remoteTasks) {
      const exists = localTasks.find(t => t.title === remoteTask.title);
      if (!exists) {
        merged.push({
          id: crypto.randomUUID(),
          ...remoteTask,
          createdAt: new Date(),
          updatedAt: new Date()
        });
      }
    }

    return merged;
  }

  private resolveByLastWrite(
    localTasks: Task[],
    remoteTasks: ParsedTask[]
  ): Task[] {
    // Last-Write-Winsï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰
    // å®Ÿéš›ã¯ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ¯”è¼ƒ
    return localTasks; // ä»®å®Ÿè£…
  }
}
```

**æˆæœç‰©**:
- `src/sync/interfaces/` (3ãƒ•ã‚¡ã‚¤ãƒ«)
- `src/sync/file-system/` (2ãƒ•ã‚¡ã‚¤ãƒ«)
- `src/sync/todo-md-watcher.ts` (200è¡Œ)
- `src/sync/conflict-resolver.ts` (150è¡Œ)
- `src/sync/__tests__/` (3ãƒ•ã‚¡ã‚¤ãƒ«ã€400è¡Œ)
- ãƒ†ã‚¹ãƒˆ: 50ã‚±ãƒ¼ã‚¹

**æ‰€è¦æ™‚é–“**: 7æ—¥é–“ï¼ˆ56æ™‚é–“ï¼‰

---

### Phase 3: MCP Toolè¿½åŠ ï¼ˆWeek 3: Day 18-20ï¼‰

**å‰æ**: Phase 2å®Œäº†

#### Day 18-19: MCP Toolå®Ÿè£…

- [ ] **sync_todo_md Toolå®Ÿè£…**
  - `src/mcp/tools/todo-md-tools.ts` ä½œæˆ
  - èªè¨¼çµ±åˆï¼ˆAuthValidatorä½¿ç”¨ï¼‰
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆRetry + Circuit Breakerï¼‰
  - ãƒ„ãƒ¼ãƒ«ç™»éŒ²ï¼ˆ`src/mcp/tools/index.ts`ï¼‰

```typescript
// src/mcp/tools/todo-md-tools.ts
import { z } from 'zod';
import { AuthValidator } from '../../sync/security/auth-validator';
import { BidrectionalSync } from '../../sync/bidirectional-sync';
import { retryWithCircuitBreaker } from '../../sync/resilience/retry-handler';

const SYNC_TODO_MD_INPUT_SCHEMA = z.object({
  todoPath: z.string().default('./TODO.md').describe('Path to TODO.md'),
  direction: z.enum(['import', 'export', 'bidirectional'])
    .default('bidirectional')
    .describe('Sync direction'),
});

export const syncTodoMdTool = {
  name: 'sync_todo_md',
  description: 'Sync TODO.md with TaskFlow App (bidirectional)',
  inputSchema: SYNC_TODO_MD_INPUT_SCHEMA,

  handler: async ({ todoPath, direction }, context) => {
    // èªè¨¼ãƒã‚§ãƒƒã‚¯
    const authValidator = new AuthValidator();
    if (!authValidator.validateMcpToken(context.authToken)) {
      throw new Error('Unauthorized MCP access');
    }

    // Retry + Circuit Breaker
    const sync = new BidrectionalSync(todoPath);
    const result = await retryWithCircuitBreaker(async () => {
      if (direction === 'import' || direction === 'bidirectional') {
        await sync.importFromTodoMd();
      }

      if (direction === 'export' || direction === 'bidirectional') {
        await sync.exportToTodoMd();
      }

      return await sync.getStats();
    });

    return {
      success: true,
      direction,
      stats: result
    };
  }
};

// src/mcp/tools/index.ts (æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µ)
import { syncTodoMdTool } from './todo-md-tools';

export const ALL_TOOLS = [
  // æ—¢å­˜26ãƒ„ãƒ¼ãƒ«
  ...existingTools,
  // æ–°è¦
  syncTodoMdTool,
];
```

#### Day 20: ãƒ†ã‚¹ãƒˆå®Ÿè£…

- [ ] **çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè£…**
  - `src/mcp/__tests__/todo-md-tools.test.ts` ä½œæˆ
  - MCP Protocolæº–æ‹ ãƒ†ã‚¹ãƒˆ
  - èªè¨¼ãƒ†ã‚¹ãƒˆ
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ

```typescript
// src/mcp/__tests__/todo-md-tools.test.ts
import { describe, it, expect, beforeEach } from 'vitest';
import { syncTodoMdTool } from '../tools/todo-md-tools';
import { MockFileSystem } from '../../sync/file-system/mock-file-system';

describe('syncTodoMdTool', () => {
  let mockContext: any;

  beforeEach(() => {
    mockContext = {
      authToken: process.env.MCP_AUTH_TOKEN,
      fs: new MockFileSystem(),
    };
  });

  it('should sync bidirectionally', async () => {
    const result = await syncTodoMdTool.handler(
      { todoPath: './TODO.md', direction: 'bidirectional' },
      mockContext
    );

    expect(result.success).toBe(true);
    expect(result.direction).toBe('bidirectional');
    expect(result.stats.syncedTasks).toBeGreaterThan(0);
  });

  it('should reject unauthorized access', async () => {
    mockContext.authToken = 'invalid';

    await expect(
      syncTodoMdTool.handler(
        { todoPath: './TODO.md', direction: 'import' },
        mockContext
      )
    ).rejects.toThrow('Unauthorized MCP access');
  });

  // ... æ®‹ã‚Š18ã‚±ãƒ¼ã‚¹
});
```

**æˆæœç‰©**:
- `src/mcp/tools/todo-md-tools.ts` (150è¡Œ)
- `src/mcp/__tests__/todo-md-tools.test.ts` (300è¡Œ)
- ãƒ†ã‚¹ãƒˆ: 20ã‚±ãƒ¼ã‚¹

**æ‰€è¦æ™‚é–“**: 3æ—¥é–“ï¼ˆ24æ™‚é–“ï¼‰

---

### Phase 4: åŒæ–¹å‘åŒæœŸå®Ÿè£…ï¼ˆWeek 3-4: Day 21-24ï¼‰

**å‰æ**: Phase 3å®Œäº†

#### Day 21-22: Markdown Generatorå®Ÿè£…

- [ ] **Markdown Generatorå®Ÿè£…**
  - `src/sync/markdown-generator.ts` ä½œæˆ
  - é…åˆ—çµåˆæœ€é©åŒ–ï¼ˆæ–‡å­—åˆ—çµåˆå›é¿ï¼‰
  - ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°
  - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ•´å½¢

```typescript
// src/sync/markdown-generator.ts
import type { Task } from '../types/task';

export class MarkdownGenerator {
  async generate(tasks: Task[], filePath: string): Promise<void> {
    const grouped = this.groupByPriority(tasks);
    const lines: string[] = [];

    // ãƒ˜ãƒƒãƒ€ãƒ¼
    lines.push('# ğŸ“‹ TaskFlow TODO\n');
    lines.push(`**æœ€çµ‚æ›´æ–°**: ${new Date().toISOString().split('T')[0]}\n`);
    lines.push('**è‡ªå‹•ç”Ÿæˆ**: TaskFlow App\n');
    lines.push('\n---\n\n');

    // ğŸ”´ æœ€å„ªå…ˆ
    if (grouped.high.length > 0) {
      lines.push('## ğŸ”´ æœ€å„ªå…ˆ\n\n');
      for (const task of grouped.high) {
        const checkbox = task.status === 'completed' ? '[x]' : '[ ]';
        lines.push(`- ${checkbox} **${task.title}**\n`);
        if (task.dueDate) {
          lines.push(`  - æœŸé™: ${task.dueDate}\n`);
        }
      }
      lines.push('\n---\n\n');
    }

    // ğŸŸ  é«˜å„ªå…ˆåº¦
    if (grouped.medium.length > 0) {
      lines.push('## ğŸŸ  é«˜å„ªå…ˆåº¦\n\n');
      for (const task of grouped.medium) {
        const checkbox = task.status === 'completed' ? '[x]' : '[ ]';
        lines.push(`- ${checkbox} ${task.title}\n`);
      }
      lines.push('\n---\n\n');
    }

    // ğŸŸ¢ é•·æœŸè¨ˆç”»
    if (grouped.low.length > 0) {
      lines.push('## ğŸŸ¢ é•·æœŸè¨ˆç”»\n\n');
      for (const task of grouped.low) {
        const checkbox = task.status === 'completed' ? '[x]' : '[ ]';
        lines.push(`- ${checkbox} ${task.title}\n`);
      }
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ï¼ˆatomic operationï¼‰
    const content = lines.join('');
    await this.fs.writeFile(filePath, content);
  }

  private groupByPriority(tasks: Task[]): {
    high: Task[];
    medium: Task[];
    low: Task[];
  } {
    return {
      high: tasks.filter(t => t.priority === 'high'),
      medium: tasks.filter(t => t.priority === 'medium'),
      low: tasks.filter(t => t.priority === 'low'),
    };
  }
}
```

#### Day 23-24: Bidirectional Syncå®Ÿè£…

- [ ] **BidrectionalSyncå®Ÿè£…**
  - `src/sync/bidirectional-sync.ts` ä½œæˆ
  - ãƒãƒƒãƒæ›¸ãè¾¼ã¿çµ±åˆ
  - 3-way mergeçµ±åˆ
  - DataLoaderæ´»ç”¨

```typescript
// src/sync/bidirectional-sync.ts
import type { FileSystem } from './interfaces/file-system.interface';
import type { Database } from './interfaces/database.interface';
import { MarkdownParser } from './markdown-parser';
import { MarkdownGenerator } from './markdown-generator';
import { ConflictResolver } from './conflict-resolver';
import { BatchWriter } from './performance/batch-writer';

export class BidrectionalSync {
  constructor(
    private todoPath: string,
    private fs: FileSystem,
    private db: Database,
    private parser: MarkdownParser,
    private generator: MarkdownGenerator,
    private conflictResolver: ConflictResolver,
    private batchWriter: BatchWriter
  ) {}

  async sync(): Promise<SyncStats> {
    // 1. ç¾åœ¨ã®IndexedDBã‚¿ã‚¹ã‚¯ã‚’å–å¾—
    const dbTasks = await this.db.getAllTasks();

    // 2. TODO.mdã‚’ãƒ‘ãƒ¼ã‚¹
    const mdTasks = await this.parser.parse(this.todoPath);

    // 3. åŸºæº–ã‚¿ã‚¹ã‚¯ã‚’å–å¾—ï¼ˆå‰å›åŒæœŸæ™‚ç‚¹ï¼‰
    const baseTasks = await this.db.getBaseTasks();

    // 4. ç«¶åˆè§£æ±ºï¼ˆ3-way mergeï¼‰
    const resolution = await this.conflictResolver.resolve(
      baseTasks,
      dbTasks,
      mdTasks
    );

    if (resolution.strategy === 'manual') {
      // æ‰‹å‹•è§£æ±ºãŒå¿…è¦ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
      throw new Error('Manual conflict resolution required');
    }

    // 5. IndexedDBã«æ›¸ãè¾¼ã¿
    await this.batchWriter.bulkUpsertTasks(resolution.resolvedTasks);

    // 6. TODO.mdã«æ›¸ãè¾¼ã¿
    await this.generator.generate(resolution.resolvedTasks, this.todoPath);

    // 7. åŸºæº–ã‚¿ã‚¹ã‚¯æ›´æ–°
    await this.db.updateBaseTasks(resolution.resolvedTasks);

    return {
      syncedTasks: resolution.resolvedTasks.length,
      conflicts: resolution.conflicts.length,
      strategy: resolution.strategy
    };
  }

  async importFromTodoMd(): Promise<void> {
    const mdTasks = await this.parser.parse(this.todoPath);
    await this.batchWriter.bulkUpsertTasks(mdTasks);
  }

  async exportToTodoMd(): Promise<void> {
    const dbTasks = await this.db.getAllTasks();
    await this.generator.generate(dbTasks, this.todoPath);
  }

  async getStats(): Promise<SyncStats> {
    const dbTasks = await this.db.getAllTasks();
    return {
      syncedTasks: dbTasks.length,
      conflicts: 0,
      strategy: '3-way-merge'
    };
  }
}

interface SyncStats {
  syncedTasks: number;
  conflicts: number;
  strategy: string;
}
```

**æˆæœç‰©**:
- `src/sync/markdown-generator.ts` (150è¡Œ)
- `src/sync/bidirectional-sync.ts` (200è¡Œ)
- `src/sync/__tests__/` (2ãƒ•ã‚¡ã‚¤ãƒ«ã€500è¡Œ)
- ãƒ†ã‚¹ãƒˆ: 40ã‚±ãƒ¼ã‚¹

**æ‰€è¦æ™‚é–“**: 4æ—¥é–“ï¼ˆ32æ™‚é–“ï¼‰

---

### Phase 5: çµ±åˆãƒ†ã‚¹ãƒˆ + ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆWeek 4: Day 25-28ï¼‰

**å‰æ**: Phase 4å®Œäº†

#### Day 25-26: E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…

- [ ] **çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè£…**
  - `src/sync/__tests__/integration.test.ts` ä½œæˆ
  - End-to-Endã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ
  - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

```typescript
// src/sync/__tests__/integration.test.ts
import { describe, it, expect, beforeEach } from 'vitest';
import { TodoMdWatcher } from '../todo-md-watcher';
import { BidrectionalSync } from '../bidirectional-sync';
import { MockFileSystem } from '../file-system/mock-file-system';
import { MockDatabase } from '../database/mock-database';

describe('TODO.md Sync Integration', () => {
  describe('File Watcher E2E', () => {
    it('should sync TODO.md changes to IndexedDB in <1s', async () => {
      const fs = new MockFileSystem();
      const db = new MockDatabase();
      const watcher = new TodoMdWatcher('./TODO.md', fs, db);

      watcher.start();

      // TODO.mdæ›´æ–°
      const startTime = Date.now();
      await fs.writeFile('./TODO.md', '## ğŸ”´ æœ€å„ªå…ˆ\n- [ ] Test Task');

      // åŒæœŸå®Œäº†å¾…æ©Ÿ
      await new Promise(resolve => setTimeout(resolve, 1000));

      const tasks = await db.getAllTasks();
      const elapsedTime = Date.now() - startTime;

      expect(tasks).toHaveLength(1);
      expect(tasks[0].title).toBe('Test Task');
      expect(elapsedTime).toBeLessThan(1000);
    });

    it('should handle 1000 tasks in <2s', async () => {
      const fs = new MockFileSystem();
      const db = new MockDatabase();

      // 1000ã‚¿ã‚¹ã‚¯ã®TODO.mdç”Ÿæˆ
      const lines = ['# TODO\n', '## ğŸ”´ æœ€å„ªå…ˆ\n'];
      for (let i = 0; i < 1000; i++) {
        lines.push(`- [ ] Task ${i}\n`);
      }
      await fs.writeFile('./TODO.md', lines.join(''));

      const startTime = Date.now();
      const sync = new BidrectionalSync('./TODO.md', fs, db);
      await sync.importFromTodoMd();
      const elapsedTime = Date.now() - startTime;

      expect(await db.count()).toBe(1000);
      expect(elapsedTime).toBeLessThan(2000);
    });
  });

  describe('Security E2E', () => {
    it('should prevent path traversal attacks', async () => {
      const fs = new MockFileSystem();
      const db = new MockDatabase();
      const sync = new BidrectionalSync('../../../etc/passwd', fs, db);

      await expect(sync.importFromTodoMd()).rejects.toThrow(
        'Path traversal detected'
      );
    });

    it('should sanitize XSS in task titles', async () => {
      const fs = new MockFileSystem();
      const db = new MockDatabase();

      await fs.writeFile(
        './TODO.md',
        '## ğŸ”´ æœ€å„ªå…ˆ\n- [ ] <script>alert("XSS")</script> Malicious Task'
      );

      const sync = new BidrectionalSync('./TODO.md', fs, db);
      await sync.importFromTodoMd();

      const tasks = await db.getAllTasks();
      expect(tasks[0].title).not.toContain('<script>');
    });
  });

  describe('Conflict Resolution E2E', () => {
    it('should resolve conflicts with 3-way merge', async () => {
      const fs = new MockFileSystem();
      const db = new MockDatabase();

      // åˆæœŸçŠ¶æ…‹
      await db.addTask({ id: '1', title: 'Task 1', status: 'pending' });

      // ä¸¡æ–¹ã§å¤‰æ›´
      await db.updateTask('1', { status: 'in_progress' });
      await fs.writeFile('./TODO.md', '## ğŸ”´ æœ€å„ªå…ˆ\n- [x] Task 1');

      const sync = new BidrectionalSync('./TODO.md', fs, db);
      const result = await sync.sync();

      expect(result.conflicts).toBeGreaterThan(0);
      expect(result.strategy).toBe('last-write-wins');
    });
  });
});
```

#### Day 27-28: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

- [ ] **ADRä½œæˆ**ï¼ˆArchitecture Decision Recordsï¼‰
  - `docs/adr/0001-file-watcher-approach.md`
  - `docs/adr/0002-3way-merge-strategy.md`
  - `docs/adr/0003-di-pattern-adoption.md`
  - `docs/adr/0004-security-requirements.md`
  - `docs/adr/0005-performance-optimization.md`

```markdown
# ADR-0001: File Watcheræ–¹å¼ã®é¸æŠ

## Status
Accepted

## Context
TODO.mdã¨TaskFlow Appã®åŒæ–¹å‘åŒæœŸã«ã¯ã€ä»¥ä¸‹3ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒè€ƒãˆã‚‰ã‚Œã‚‹ï¼š
1. File Watcheræ–¹å¼ï¼ˆchokidarï¼‰
2. MCP Toolæ–¹å¼ï¼ˆæ‰‹å‹•åŒæœŸï¼‰
3. Webhookæ–¹å¼ï¼ˆç‰‡æ–¹å‘ï¼‰

## Decision
File Watcheræ–¹å¼ã‚’ãƒ¡ã‚¤ãƒ³åŒæœŸæ–¹å¼ã¨ã—ã¦æ¡ç”¨ã—ã€MCP Tool/Webhookã‚’è£œåŠ©ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã€‚

## Rationale
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸï¼ˆ<1ç§’ï¼‰ã‚’å®Ÿç¾
- Claude Codeç·¨é›†ã¨ã®è¦ªå’Œæ€§ãŒé«˜ã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œä¸è¦ã§è‡ªå‹•åŒæœŸ

## Consequences
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ™ãƒ³ãƒˆä¾å­˜ï¼ˆOSã«ã‚ˆã‚‹æŒ™å‹•å·®ç•°ï¼‰
- ç„¡é™ãƒ«ãƒ¼ãƒ—ãƒªã‚¹ã‚¯ï¼ˆåŒæ–¹å‘åŒæœŸæ™‚ã®å¯¾ç­–ãŒå¿…è¦ï¼‰
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å¢—åŠ ï¼ˆwatcherå¸¸é§ï¼‰

## Implementation Notes
- chokidar v3.6.0ä½¿ç”¨
- Debounce 500ms + Throttle 2sçµ„ã¿åˆã‚ã›
- ä¸€æ™‚åœæ­¢æ©Ÿæ§‹ã§ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢
```

- [ ] **API Referenceæ›´æ–°**
  - `docs/API_REFERENCE.md` ã« `sync_todo_md` è¿½åŠ 

- [ ] **READMEæ›´æ–°**
  - `README.md` ã®Usage Examplesã«åŒæœŸæ©Ÿèƒ½è¿½åŠ 

**æˆæœç‰©**:
- `src/sync/__tests__/integration.test.ts` (600è¡Œ)
- `docs/adr/` (5ãƒ•ã‚¡ã‚¤ãƒ«ã€å„500è¡Œ)
- `docs/TODO_MD_SYNC_IMPLEMENTATION_PLAN.md` (ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«)
- ãƒ†ã‚¹ãƒˆ: 30ã‚±ãƒ¼ã‚¹ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ5ã‚±ãƒ¼ã‚¹

**æ‰€è¦æ™‚é–“**: 4æ—¥é–“ï¼ˆ32æ™‚é–“ï¼‰

---

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…è©³ç´°

### çµ±ä¸€å‹å®šç¾©ï¼ˆSingle Source of Truthï¼‰

```typescript
// src/types/task.ts
export type TaskStatus = 'pending' | 'in_progress' | 'completed';
export type TaskPriority = 'low' | 'medium' | 'high';

export interface BaseTask {
  id: string;
  title: string;
  status: TaskStatus;
  priority: TaskPriority;
  dueDate?: string;
  description?: string;
  createdAt: Date;
  updatedAt: Date;
}

export interface ParsedTask extends Omit<BaseTask, 'id' | 'createdAt' | 'updatedAt'> {
  section: string; // Markdownå›ºæœ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆğŸ”´æœ€å„ªå…ˆç­‰ï¼‰
}

export type DbTask = BaseTask; // IndexedDBç”¨
export type GqlTask = BaseTask; // GraphQLç”¨

export interface TaskConflict {
  taskId: string;
  base: BaseTask;
  local: BaseTask;
  remote: ParsedTask;
  conflictType: 'both-modified' | 'local-deleted' | 'remote-deleted';
}
```

### è¨­å®šå¤–éƒ¨åŒ–

```typescript
// src/config/todo-sync.config.ts
import { z } from 'zod';

const TODO_SYNC_CONFIG_SCHEMA = z.object({
  TODO_MD_PATH: z.string().default('./TODO.md'),
  TODO_DEBOUNCE_MS: z.number().min(100).max(5000).default(500),
  TODO_THROTTLE_MS: z.number().min(500).max(10000).default(2000),
  TODO_MAX_FILE_SIZE_MB: z.number().min(1).max(50).default(5),
  TODO_MAX_TASKS: z.number().min(100).max(100000).default(10000),
  TODO_WEBHOOKS_ENABLED: z.boolean().default(false),
  MCP_AUTH_TOKEN: z.string().min(32).optional(),
  NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),
});

export const TODO_SYNC_CONFIG = TODO_SYNC_CONFIG_SCHEMA.parse({
  TODO_MD_PATH: process.env.TODO_MD_PATH,
  TODO_DEBOUNCE_MS: Number(process.env.TODO_DEBOUNCE_MS),
  TODO_THROTTLE_MS: Number(process.env.TODO_THROTTLE_MS),
  TODO_MAX_FILE_SIZE_MB: Number(process.env.TODO_MAX_FILE_SIZE_MB),
  TODO_MAX_TASKS: Number(process.env.TODO_MAX_TASKS),
  TODO_WEBHOOKS_ENABLED: process.env.TODO_WEBHOOKS_ENABLED === 'true',
  MCP_AUTH_TOKEN: process.env.MCP_AUTH_TOKEN,
  NODE_ENV: process.env.NODE_ENV,
});
```

### ç’°å¢ƒå¤‰æ•°è¨­å®š

```bash
# .env.example ã«è¿½åŠ 
TODO_MD_PATH=./TODO.md
TODO_DEBOUNCE_MS=500
TODO_THROTTLE_MS=2000
TODO_MAX_FILE_SIZE_MB=5
TODO_MAX_TASKS=10000
TODO_WEBHOOKS_ENABLED=false
MCP_AUTH_TOKEN=your-32-char-token-here
```

---

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸ | é‡ç‚¹é …ç›® |
|--------------|--------------|---------|
| **Securityå±¤** | 95%+ | Path traversalã€XSSã€èªè¨¼ |
| **Performanceå±¤** | 90%+ | å·®åˆ†æ¤œå‡ºã€ãƒãƒƒãƒå‡¦ç† |
| **Parser/Generator** | 90%+ | Markdownæ§‹æ–‡ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ |
| **Conflict Resolver** | 90%+ | 3-way mergeã€ç«¶åˆæ¤œå‡º |
| **Integration** | 80%+ | E2Eã‚·ãƒŠãƒªã‚ª |

### ãƒ†ã‚¹ãƒˆç¨®åˆ¥

#### 1. å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆUnit Testsï¼‰

```bash
# å®Ÿè¡Œ
npm test -- src/sync/__tests__/markdown-parser.test.ts

# ã‚«ãƒãƒ¬ãƒƒã‚¸
npm run test:coverage -- src/sync/
```

#### 2. çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆIntegration Testsï¼‰

```bash
# å®Ÿè¡Œ
npm test -- src/sync/__tests__/integration.test.ts

# E2Eã‚·ãƒŠãƒªã‚ª
npm test -- --grep "E2E"
```

#### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

```bash
# 1000ã‚¿ã‚¹ã‚¯åŒæœŸãƒ†ã‚¹ãƒˆ
npm test -- --grep "performance"

# ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°
npm test -- --reporter=verbose --profile
```

#### 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

```bash
# Path traversalã€XSSç­‰
npm test -- --grep "security"

# é™çš„è§£æ
npm audit
npm run lint
```

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿

```typescript
// src/sync/__tests__/fixtures/
// - simple.md: åŸºæœ¬çš„ãªã‚¿ã‚¹ã‚¯ï¼ˆ10ä»¶ï¼‰
// - large.md: å¤§é‡ã‚¿ã‚¹ã‚¯ï¼ˆ1000ä»¶ï¼‰
// - xss.md: XSSæ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³
// - conflicted.md: ç«¶åˆçŠ¶æ…‹ã®ã‚¿ã‚¹ã‚¯
```

---

## ãƒªã‚¹ã‚¯ç®¡ç†

### ğŸ”´ é«˜ãƒªã‚¹ã‚¯ï¼ˆç™ºç”Ÿæ™‚ã®å½±éŸ¿å¤§ï¼‰

#### 1. ãƒ‡ãƒ¼ã‚¿ãƒ­ã‚¹

**ãƒªã‚¹ã‚¯**: ç«¶åˆè§£æ±ºå¤±æ•—ã§ã‚¿ã‚¹ã‚¯æ¶ˆå¤±

**å¯¾ç­–**:
- 3-way mergeå®Ÿè£…
- è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆTODO.md.backupï¼‰
- æ‰‹å‹•è§£æ±ºUIï¼ˆPhase 6ã§å®Ÿè£…ï¼‰

**è»½æ¸›ç­–**:
```typescript
// ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿæ§‹
async function backupTodoMd(filePath: string): Promise<void> {
  const content = await fs.readFile(filePath, 'utf-8');
  const backupPath = `${filePath}.backup.${Date.now()}`;
  await fs.writeFile(backupPath, content);

  // å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‰Šé™¤ï¼ˆ7æ—¥ä»¥ä¸Šï¼‰
  await cleanupOldBackups(filePath, 7);
}
```

#### 2. ç„¡é™ãƒ«ãƒ¼ãƒ—

**ãƒªã‚¹ã‚¯**: File Watcher â†” Markdown Generator ã®ç„¡é™ãƒ«ãƒ¼ãƒ—

**å¯¾ç­–**:
- Watcherä¸€æ™‚åœæ­¢æ©Ÿæ§‹
- å¤‰æ›´æ¤œå‡ºã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç®¡ç†
- Throttleåˆ¶é™

**è»½æ¸›ç­–**:
```typescript
// ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢
let lastWriteTime = Date.now();

async function writeWithPause(watcher: TodoMdWatcher, content: string) {
  watcher.pause();
  await fs.writeFile('./TODO.md', content);
  lastWriteTime = Date.now();

  setTimeout(() => {
    watcher.resume();
  }, 1000);
}
```

#### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–

**ãƒªã‚¹ã‚¯**: å¤§é‡ã‚¿ã‚¹ã‚¯ï¼ˆ10,000+ï¼‰ã§2ç§’ä»¥ä¸Šã®åŒæœŸæ™‚é–“

**å¯¾ç­–**:
- å·®åˆ†æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
- IndexedDBãƒãƒƒãƒæ›¸ãè¾¼ã¿
- DataLoaderæ´»ç”¨

**è»½æ¸›ç­–**:
```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
import { performance } from 'perf_hooks';

async function measureSync() {
  const start = performance.now();
  await sync.sync();
  const duration = performance.now() - start;

  if (duration > 2000) {
    logger.warn('Slow sync detected', { duration });
  }
}
```

### ğŸŸ¡ ä¸­ãƒªã‚¹ã‚¯

#### 4. ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ™ãƒ³ãƒˆæœªç™ºç«

**ãƒªã‚¹ã‚¯**: OSã«ã‚ˆã£ã¦chokidarã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãªã„

**å¯¾ç­–**:
- MCP Toolæ‰‹å‹•åŒæœŸã‚’ä½µç”¨
- Polling fallbackæ©Ÿæ§‹

#### 5. èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³æ¼æ´©

**ãƒªã‚¹ã‚¯**: MCP_AUTH_TOKENãŒGitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹

**å¯¾ç­–**:
- `.gitignore`ã«`.env`è¿½åŠ 
- `.env.example`ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæä¾›
- èµ·å‹•æ™‚ã®ç’°å¢ƒå¤‰æ•°æ¤œè¨¼

### ğŸŸ¢ ä½ãƒªã‚¹ã‚¯

#### 6. Markdownæ§‹æ–‡ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼

**ãƒªã‚¹ã‚¯**: ç‰¹æ®Šãªæ§‹æ–‡ã§ãƒ‘ãƒ¼ã‚¹å¤±æ•—

**å¯¾ç­–**:
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
- ãƒ­ã‚°è¨˜éŒ²

---

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å³åº§ã«å®Ÿæ–½ã™ã¹ãã“ã¨

1. **Phase 0é–‹å§‹æ‰¿èª**
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºç›¤æ•´å‚™ï¼ˆWeek 1ï¼‰
   - æŠ€è¡“é¸å®šã®æœ€çµ‚ç¢ºèª

2. **ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```bash
cd ~/workspace/taskflow-app/taskflow-graphql
npm install --save \
  chokidar \
  fast-diff \
  isomorphic-dompurify \
  @lifeomic/attempt \
  opossum \
  lodash-es

npm install --save-dev \
  @types/chokidar \
  @types/lodash-es
```

3. **ç’°å¢ƒå¤‰æ•°è¨­å®š**
```bash
# .env ã«è¿½åŠ 
echo "TODO_MD_PATH=./TODO.md" >> .env
echo "TODO_DEBOUNCE_MS=500" >> .env
echo "TODO_MAX_FILE_SIZE_MB=5" >> .env
echo "MCP_AUTH_TOKEN=$(openssl rand -base64 32)" >> .env
```

4. **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ**
```bash
mkdir -p src/sync/{security,performance,resilience,interfaces,file-system,database,__tests__}
mkdir -p docs/adr
```

### ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãŒå¿…è¦ãªç‚¹

1. **ç«¶åˆè§£æ±ºUI**
   - æ‰‹å‹•è§£æ±ºãŒå¿…è¦ãªç«¶åˆã‚’ã©ã†è¡¨ç¤ºã™ã‚‹ã‹ï¼Ÿ
   - React App vs Claude Code ã©ã¡ã‚‰ã§å¯¾å¿œï¼Ÿ

2. **åŒæœŸãƒˆãƒªã‚¬ãƒ¼ã®å„ªå…ˆé †ä½**
   - File Watcherï¼ˆè‡ªå‹•ï¼‰vs MCP Toolï¼ˆæ‰‹å‹•ï¼‰ã®ã©ã¡ã‚‰ã‚’ä¸»è»¸ï¼Ÿ
   - Webhookä½µç”¨ã®åˆ¤æ–­åŸºæº–ã¯ï¼Ÿ

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨±å®¹ç¯„å›²**
   - æœ€å¤§ã‚µãƒãƒ¼ãƒˆã‚¿ã‚¹ã‚¯æ•°: 10,000? 100,000?
   - åŒæœŸæ™‚é–“ç›®æ¨™: <1s? <2s?

4. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥**
   - è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ä¿æŒæœŸé–“: 7æ—¥? 30æ—¥?
   - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸–ä»£æ•°: 10ä¸–ä»£? ç„¡åˆ¶é™?

---

## å‚è€ƒãƒªãƒ³ã‚¯

- **chokidar**: https://github.com/paulmillr/chokidar
- **fast-diff**: https://github.com/jhchen/fast-diff
- **isomorphic-dompurify**: https://github.com/kkomelin/isomorphic-dompurify
- **@lifeomic/attempt**: https://github.com/lifeomic/attempt
- **opossum**: https://github.com/nodeshift/opossum
- **MCP Protocol**: https://modelcontextprotocol.io/

---

## ä»˜éŒ²

### A. å…¨Phaseæ‰€è¦æ™‚é–“ã¾ã¨ã‚

| Phase | æœŸé–“ | å·¥æ•° |
|-------|-----|------|
| Phase 0: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ”¹å–„ | Week 1 (7æ—¥) | 56æ™‚é–“ |
| Phase 1: Markdown Parser | Week 2 (3æ—¥) | 24æ™‚é–“ |
| Phase 2: File Watcher + DI | Week 2-3 (7æ—¥) | 56æ™‚é–“ |
| Phase 3: MCP Tool | Week 3 (3æ—¥) | 24æ™‚é–“ |
| Phase 4: Bidirectional Sync | Week 3-4 (4æ—¥) | 32æ™‚é–“ |
| Phase 5: çµ±åˆãƒ†ã‚¹ãƒˆ + Docs | Week 4 (4æ—¥) | 32æ™‚é–“ |
| **åˆè¨ˆ** | **28æ—¥** | **224æ™‚é–“** |

### B. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### Phase 0å®Œäº†ãƒã‚§ãƒƒã‚¯
- [ ] Path Validatorå®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] Auth Validatorå®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] Markdown Sanitizerå®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] Batch Writerå®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] Diff Detectorå®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] Throttle + Debounceå®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] å‹å®šç¾©çµ±ä¸€å®Œäº†
- [ ] Retry + Circuit Breakerå®Ÿè£…å®Œäº†
- [ ] æ§‹é€ åŒ–ãƒ­ã‚°å°å…¥å®Œäº†
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸90%+é”æˆ

#### Phase 1å®Œäº†ãƒã‚§ãƒƒã‚¯
- [ ] Markdown Parserå®Ÿè£…å®Œäº†
- [ ] å·®åˆ†ãƒ‘ãƒ¼ã‚¹å¯¾å¿œå®Œäº†
- [ ] ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆå®Œäº†
- [ ] ãƒ†ã‚¹ãƒˆ30ã‚±ãƒ¼ã‚¹å®Œäº†
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸90%+é”æˆ

#### Phase 2å®Œäº†ãƒã‚§ãƒƒã‚¯
- [ ] FileSystemæŠ½è±¡åŒ–å®Œäº†
- [ ] DatabaseæŠ½è±¡åŒ–å®Œäº†
- [ ] TodoMdWatcherå®Ÿè£…å®Œäº†
- [ ] Conflict Resolverå®Ÿè£…å®Œäº†
- [ ] 3-way mergeå®Ÿè£…å®Œäº†
- [ ] ãƒ†ã‚¹ãƒˆ50ã‚±ãƒ¼ã‚¹å®Œäº†

#### Phase 3å®Œäº†ãƒã‚§ãƒƒã‚¯
- [ ] sync_todo_md Toolå®Ÿè£…å®Œäº†
- [ ] èªè¨¼çµ±åˆå®Œäº†
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Œäº†
- [ ] ãƒ†ã‚¹ãƒˆ20ã‚±ãƒ¼ã‚¹å®Œäº†

#### Phase 4å®Œäº†ãƒã‚§ãƒƒã‚¯
- [ ] Markdown Generatorå®Ÿè£…å®Œäº†
- [ ] BidrectionalSyncå®Ÿè£…å®Œäº†
- [ ] ãƒ†ã‚¹ãƒˆ40ã‚±ãƒ¼ã‚¹å®Œäº†

#### Phase 5å®Œäº†ãƒã‚§ãƒƒã‚¯
- [ ] E2Eãƒ†ã‚¹ãƒˆ30ã‚±ãƒ¼ã‚¹å®Œäº†
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ5ã‚±ãƒ¼ã‚¹å®Œäº†
- [ ] ADR 5ä»¶ä½œæˆå®Œäº†
- [ ] READMEæ›´æ–°å®Œäº†
- [ ] API Referenceæ›´æ–°å®Œäº†

---

**ä½œæˆè€…**: Claude Code (Sonnet 4.5)
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: 3è¦–ç‚¹åå¾©ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†
**æ‰¿èª**: å®Ÿè£…é–‹å§‹å‰ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªå¿…è¦
